# Проект: Автоматизированная установка и настройка Semaphore

Этот проект представляет собой промежуточную зачетную работу по курсу **DevOps Upgrade** от [СЛЁРМ](https://slurm.io/devops-upgrade). 
- Основная цель — создание и настройка CI/CD системы [Semaphore](https://semaphoreci.com/) с использованием Ansible и Vagrant. Проект включает написание Ansible playbook для установки и конфигурации Semaphore, а также Vagrant для автоматического создания виртуальной среды.

## Описание проекта

Проект автоматизирует установку и настройку следующих компонентов:
- Установка пакета `acl` и `Ansible` на управляемом хосте, с помощью Vagrant.
- Установка и настройка PostgreSQL с использованием роли `geerlingguy.postgresql`.
- Загрузка и установка Semaphore с настройкой конфигурационного файла.
- Автоматическое создание пользователя Semaphore с правами администратора.

## Требования

- **Vagrant** для создания и управления виртуальными машинами.
- **Ansible** для автоматизации установки и настройки.
- Поддерживаемая операционная система: **Ubuntu 24.04** (базовый образ Vagrant: `bento/ubuntu-24.04`).


## Быстрый старт

### Шаг 1: Клонирование репозитория

Сначала клонируйте проект:

```bash
git clone <URL_репозитория>
cd <название_папки>
```

### Шаг 2: Запуск Vagrant

Поднимите виртуальную машину с помощью Vagrant:

```bash
vagrant up
```
### Шаг 3: Запуск Playbook
После создания виртуальной машины войдите в неё и запустите Ansible playbook для установки и настройки Semaphore:

```bash
vagrant ssh
cd /vagrant
ansible-playbook -i inventory semaphore-install.yml
```
## Структура проекта

- **Vagrantfile** — конфигурация для создания виртуальной машины с помощью Vagrant.
- **inventory** — файл инвентаря Ansible, указывающий на localhost.
- **semaphore-install.yml** — основной playbook для установки и настройки Semaphore.
- **.vars/** - каталог содержащий переменные для запуска плейбука
- **.templates/** - каталог содержащий шаблоны j2
### Описание Playbook
#### Playbook включает следующие основные задачи:


- Установка роли geerlingguy.postgresql для настройки PostgreSQL.
- Установка пакета Semaphore из источника.
- Создание пользователя semaphore.
- Настройка конфигурации Semaphore и запуск службы.
#### Переменные и параметры
- Параметры SemaphoreUI: параметры для запуска службы задаются в файле /opt/semaphore/config.json. Этот файл генерируется автоматически с параметрами, которые могут быть изменены при необходимости.
- Проброс порта: Vagrant автоматически пробрасывает порт 3000 на локальную машину.
## Заключение
Данный проект демонстрирует применение Ansible для автоматизации задач CI/CD и использования Vagrant для создания изолированной среды для разработки.

Примечание: Для более глубокой настройки и интеграции Semaphore в CI/CD, рекомендуется ознакомиться с официальной документацией Semaphore.